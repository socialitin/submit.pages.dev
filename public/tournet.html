<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <title>Cloudflare Pages 2 Tournet presence</title>
  <meta name="theme-color" content="#d86300">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="https://www.cloudflare.com/favicon-128.png">
  <link rel="stylesheet" href="/index.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .tab {
      display: flex;
      flex-direction: row;
      justify-content: space-evenly;
      background-color: #f1f1f10e;
      padding: 0;
      width: 100%;
      margin-top: 4%;
    }

      .tab button {
        width: 20%;
        background-color: #c46767;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 10px;
        color: white;
        font-size: 16px;
        transition: background-color 0.3s ease;
        margin: 0;
      }

        .tab button:hover {
          background-color: #b35454;
        }

        .tab button.active {
          background-color: #e54646;
        }

    .tabcontent {
      display: none;
      width: 100%;
      padding: 6px 12px;
      border: 1px solid #ccc;
      border-top: none;
      margin: 20px auto;
    }

      .tabcontent.active {
        display: block;
      }

    .pitch-container, .carousel-container {
      overflow-x: auto;
      white-space: nowrap;
      display: flex;
      align-items: center;
      padding: 10px 0;
      margin-left: 10%;
    }

    .pitch-item, .carousel-item {
      display: inline-block;
      margin-right: 20px;
      text-align: center;
    }

      .pitch-item img, .carousel-item img {
        display: block;
        margin: 0 auto;
      }

      .pitch-item span, .carousel-item span {
        display: block;
        margin-top: 10px;
        color: #333;
        font-size: 14px;
      }

    @media (max-width: 768px) {
      .tab {
        flex-direction: column;
      }

        .tab button {
          width: 100%;
          margin: 5px 0;
        }

      .carousel-item {
        margin-right: 10px;
      }

        .carousel-item span {
          font-size: 12px;
        }
    }

    @media (max-width: 480px) {
      .tab button {
        font-size: 14px;
      }

      .carousel-item {
        margin-right: 5px;
      }

        .carousel-item span {
          font-size: 10px;
        }
    }

    #chat-container {
      width: 400px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

      #chat-container h2 {
        text-align: center;
        color: #007bff;
      }

    #message-input, #conversation-list {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    #chat-container button {
      width: 100%;
      padding: 10px;
      background-color: #c2cdd9;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 10px;
    }

    .icon-button {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1.5rem;
      color: #cdd6df;
      margin: 5px;
    }

      .icon-button:hover {
        color: #c3ced8;
      }

    #conversation-list, #conversation-messages {
      margin-top: 20px;
    }

    .conversation-option {
      display: inline-block;
      margin-right: 15px;
    }

    #message-input-container {
      margin-top: 20px;
    }

    #initial-request {
      margin-top: 20px;
      font-size: 1.5rem;
      font-weight: bold;
    }

    .conversation-entry {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }

      .conversation-entry p {
        margin: 0;
        margin-left: 10px;
      }
  </style>
</head>
<body>
  <div style="margin-left: 20%; position:relative; display:block;">
    <img src="https://tournet.com/SocialITIN/img/www.tournet.com_wZn.png" style="border:0; width:50%;">
  </div>
  <div>
    <div class="tab">
      <button class="tablinks active" onclick="openTab(event, 'Tab2')">Concierge</button>
      <button class="tablinks" onclick="openTab(event, 'Tab4')">MyItim</button>
    </div>
    <div id="Tab1" class="tabcontent">
      <main>
        <h2>Basic Subscription is FREE</h2>
        <blockquote>
          <p id="subjjson" data-json=''>
            To Pitch on Tournet's cityKIOSKS network, Hosts must be verified. Please complete this Subscription Form first,
            complete your first Pitch, which you can privately Test & Preview on the actual network while waiting approval process ...
          </p>
        </blockquote>
        <form method="POST" action="/api/subscribe">
          <div class="input">
            <label for="name">Company Name and Address</label>
            <input id="name" name="name" type="text" />
            <label for="web">Company Website</label>
            <input id="web" name="web" type="url" />
          </div>
          <div class="input">
            <label for="contact">Your Complete Name</label>
            <input id="contact" name="contact" type="text" />
            <label for="email">Company Email</label>
            <input id="email" name="email" type="email" />
          </div>
          <div class="input">
            <label for="referers">Type/kind of offer</label>
            <select id="referers" name="referers">
              <option hidden disabled selected value></option>
              <option value="Sightseeing">Sightseeing</option>
              <option value="Excursion">Excursion</option>
              <option value="Night life">Night life</option>
              <option value="Walking tour">Walking tour</option>
              <option value="Water cruising">Water cruising</option>
            </select>
          </div>
          <div class="checklist">
            <label>What's the venue</label>
            <ul>
              <li>
                <input id="m1" type="checkbox" name="venue" value="Attraction" />
                <label for="m1">Attraction</label>
              </li>
              <li>
                <input id="m2" type="checkbox" name="venue" value="Club" />
                <label for="m2">Club</label>
              </li>
              <li>
                <input id="m3" type="checkbox" name="venue" value="Accommodation" />
                <label for="m3">Accommodation</label>
              </li>
              <li>
                <input id="m4" type="checkbox" name="venue" value="Motorcoach" />
                <label for="m4">Motorcoach</label>
              </li>
            </ul>
          </div>
          <div class="input">
            <label for="pitch">Name and description of Product or Offer</label>
            <input id="pitch" name="pitch" type="text" />
          </div>
          <button type="submit">Join Tournet</button>
        </form>
      </main>
    </div>
    <div id="Tab2" class="tabcontent active">
      <div id="jdata">
        <div class="pitch-container">
          <div class="pitch-item">
            <img id="fjson1" src="https://tournet.com/SocialITIN/img/blank.jpg" data-offer='' width="102px" height="102px" alt="Offer 1" onclick="d1tnhosts(event,src)">
            <span>Offer 1</span>
          </div>
          <div class="pitch-item">
            <img id="fjson2" src="https://tournet.com/SocialITIN/img/blank.jpg" data-offer='' width="102px" height="102px" alt="Offer 2" onclick="d1tnhosts()">
            <span>Offer 2</span>
          </div>
          <div class="pitch-item">
            <img id="fjson3" src="https://tournet.com/SocialITIN/img/blank.jpg" data-offer='' width="102px" height="102px" alt="Offer 3" onclick="d1tnhosts()">
            <span>Offer 3</span>
          </div>
          <div class="pitch-item">
            <img id="fjson4" src="https://tournet.com/SocialITIN/img/blank.jpg" data-offer='' width="102px" height="102px" alt="Offer 4" onclick="d1tnhosts()">
            <span>Offer 4</span>
          </div>
        </div>
        <script>
          window.addEventListener('DOMContentLoaded', () => {
            d1tnlogin();
          });
        </script>
      </div>
      <div class="row">
        <div id="thumbs" class="carousel-container" style="width:15%; float:left;"></div>
        <div width="2%"></div>
        <div id="ofrContainerFormkiosk" data-ofr='{"vendorId":227, "ofr_id": 538, "pds_id": 272825 }' data-mode="kiosk" data-view="mobile" style="width:100%; margin-top:50px; margin-left:5px; float:left;"></div>
        <div>
          <div id="itemImg" style="width:61%; float:left;"></div>
          <div id="picDtls" style="width:20%; margin-left:20%"></div>
        </div>
      </div>
    </div>
    <div id="Tab3" class="tabcontent">
      <p style="float:right;">Publish <img id="fjson1" src="https://tournet.com/SocialITIN/img/blank.jpg" width="32px" height="32px" onclick="d1tnupdate();"></p>
      <main>
        <h2>Pitch your Offer</h2>
        <blockquote>
          <p id="sjson" data-json=''>Review Your Pitch</p>
          <p>All Pitches submitted are private. You can publish one and only one at a time (Premium members can publish up to 4).</p>
        </blockquote>
        <form method="POST" action="/api/submit">
          <div class="input" type="hidden">
            <label for="IATA"></label>
            <input id="IATA" name="IATA" type="text" />
            <input id="Province" name="Province" type="text" />
          </div>
          <div class="input">
            <label for="City">Name of Offer</label>
            <input id="City" name="City" type="text" />
          </div>
          <div class="input">
            <label for="embVideo">Video</label>
            <input id="embVideo" name="embVideo" type="text" />
          </div>
          <div class="input">
            <label for="Pictures">Pictures</label>
            <input id="Pictures" name="Pictures" type="text" />
          </div>
          <div class="input">
            <label for="typeKind">Type/kind of offer</label>
            <select id="typeKind" name="typeKind">
              <option hidden disabled selected value></option>
              <option value="Sightseeing">Sightseeing</option>
              <option value="Excursion">Excursion</option>
              <option value="Night life">Night life</option>
              <option value="Walking tour">Walking tour</option>
              <option value="Water cruising">Water cruising</option>
            </select>
          </div>
          <div class="checklist">
            <label for="venue">What's the venue</label>
            <select id="venue" name="venue">
              <option hidden disabled selected value></option>
              <option value="Attraction">Attraction</option>
              <option value="Club">Club, Event</option>
              <option value="Accommodation">Accommodation</option>
              <option value="Motorcoach">Motorcoach</option>
              <option value="Other">Other ...</option>
            </select>
          </div>
          <div class="input">
            <label for="pitch">Pitch!</label>
            <input id="pitch" name="pitch" type="text" />
          </div>
          <button type="submit">Save & Preview</button>
        </form>
      </main>
    </div>
    <div id="Tab4" class="tabcontent">
      <main>
        <h4>My Itineraries</h4>
        <blockquote>
          <p id="Requests">
            Coming Up... Tournet's cityKIOSKS Visitors' Requests Response is instant or within 24 hours at the latest.
            <br>
            <h4>Host Conversations</h4>
            <div id="chat-container">
              <h4>Your WhatsApp number</h4>
              <input id="itin-id-input" placeholder="e.g., 1212555888, country code inclusive" />
              <input id="channel-input" type="hidden" placeholder="Posting to Channel (e.g., NYCDE)" />
              <button id="load-channel-button" class="icon-button" title="Load Channel">
                <i class="fas fa-sync"></i>
              </button>
              <button id="initiate-button" class="icon-button" title="Initiate Conversation" style="display: none">
                <i class="fas fa-paper-plane"></i>
              </button>
              <div id="conversation-list"></div>
              <div id="conversation-messages">
                <div id="initial-request"></div>
                <h3>Conversation Messages</h3>
              </div>
              <div id="message-input-container">
                <textarea id="message-input" placeholder="Type a message to Host"></textarea>
                <button id="reply-button" class="icon-button" title="Reply to Conversation">
                  <i class="fas fa-reply"></i>
                </button>
              </div>
            </div>
          </p>
        </blockquote>
      </main>
    </div>
  </div>
  <script>
    function openTab(evt, tabName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }
  </script>
</body>
</html>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    function openTab(evt, tabName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }

    async function d1tnlogin() {
      const workerUrl = 'https://grabjson.socialitin.workers.dev/';
      try {
        const response = await fetch(workerUrl);
        if (!response.ok) {
          return;
        }
        const mpitch = await response.json();
        console.log('mpitch', mpitch);
        let cItems = 0;
        for (const group in mpitch) {
          if (mpitch.hasOwnProperty(group)) {
            const groupName = group;
            const tgroup = group;
            console.log(`Group: ${groupName}`);
            cItems++;
            let jdata = [];
            mpitch[group].forEach(item => {
              const currentItem = item;
              const cItem = item;
              const pcountry = group.substring(0, 3) + '/';
              const tImg = `https://mmedia.tournet.com/Tournet/Destinations/Presentation/${pcountry}${tgroup}/${cItem.City}.jpg`;
              const Tpics = { "img": tImg, "name": cItem.City, "description": cItem.Pitch, "iata": cItem.IATA };
              jdata.push(Tpics);
              console.log('imgs ', Tpics);
              document.getElementById('fjson' + cItems).src = tImg;
              $('#fjson' + cItems).attr('data-offer', JSON.stringify(jdata));
              console.log(`Name: ${currentItem.IATA}, Score: ${currentItem.City}`);
            });
            document.getElementById("fjson1").click();
            setTimeout(function () {
              document.getElementById("0").click();
            }, 500);
            console.log('');
          }
        }
      } catch (error) {
        console.error('Error fetching JSON:', error);
      }
    }

    async function d1tnupdate() {
      const response = await fetch('/api/d1tnupdate');
      const data2 = await response.json();
      console.log(data2);
    }

    async function d1tnhosts(evt, src) {
      const data2 = evt.target.getAttribute('data-offer');
      const picsj = JSON.parse(data2);
      const picis = picsj[0].img;
      const pcount = evt.target.id;
      const picUrl = `<img id="${pcount}u" src="${picis}" style="width:99%;"></img>`;
      console.log('thispitch', picsj);
      let tImgAll = '';
      for (let h = 0; h < picsj.length; h++) {
        const tIata = picsj[h].iata;
        const tname = picsj[h].name;
        const tdesc = picsj[h].description;
        const jdata = [tIata, tname, tdesc];
        const tImg = `<div class="carousel-item"><img name="${jdata}" data="${picsj[h]}" id="${h}" src="${picsj[h].img}" style="width:102px; height:102px;" onclick="picsDtl(event,src,name);"></div>`;
        tImgAll += tImg;
      }
      document.getElementById("thumbs").style = "display: flex; overflow-x: auto; white-space: nowrap;";
      document.getElementById("thumbs").innerHTML = tImgAll;
      document.getElementById("itemImg").style = "width: 100%;";
      const tVideo = `<div width="20%">${data.embVideo}${data.Pitch}</div>`;
      document.getElementById("itemImg").innerHTML = tVideo;
      document.getElementById("IATA").value = data.IATA;
      document.getElementById("City").value = data.City;
      document.getElementById("Province").value = data.Province;
      document.getElementById("pitch").value = data.Pitch;
      document.getElementById("Pictures").value = pics;
      document.getElementById("embVideo").value = tVideo;
      const picsUpl = `
        <form id="upload-video3" onsubmit="uploadImage(event)">
          <div>
            <input id="offer" value="${data.City}">
            <textarea>
              <input id="pitch" value="${data.Pitch} textarea"></textarea>
            <input type="file" id="v-input" fname="file" onchange="previewImage(event)">
            <button type="submit">Upload Video</button>
          </div>
        </form>`;
      document.getElementById('picDtls').style = "width:100%;";
      document.getElementById('picDtls').innerHTML = picsUpl;
    }

    function picsDtl(evt, src, name) {
      const picis = src;
      const Pname = name.split(',')[2];
      const Pdesc = name.split(',')[1];
      const pIata = name.split(',')[0];
      const pcount = evt.target.id;
      const picUrl = `<img id="${pcount}u" src="${picis}" style="width:99%;"></img>`;
      const tiata = pIata.toString() + 'S';
      const PIata = tiata.length < 4 ? "NYCSS" : tiata;
      document.getElementById('channel-input').value = PIata;
      document.getElementById("itemImg").innerHTML = picUrl;
      const picsUpl = `
        <form id="upload-form${pcount}" onsubmit="uploadImage(event)">
          <div>
            <input id="picname" value="${Pname}">
            <input id="descI" value="${Pdesc}">
            <input type="file" style="display: none;" id="file-input" name="file" onchange="previewImage(event)">
            <button type="submit" style="display: none;">Upload Image</button>
          </div>
        </form>`;
      const pItin = `
        <div>
          <input id="cell" placeholder="type your cell number"> Connect with Host
          <i class="fas fa-paper-plane" onclick="connectWithHost()"></i>
        </div>`;
      document.getElementById('picDtls').innerHTML = picsUpl + pItin;
    }

    function connectWithHost() {
      const cellValue = document.getElementById('cell').value;
      if (cellValue.trim() === "") {
        alert("Please enter your cell number.");
        return;
      }
      document.getElementById('itin-id-input').value = cellValue;
      document.getElementById('load-channel-button').click();
      document.getElementById('initiate-button').click();
    }

    function previewImage(event) {
      const fileInput = event.target;
      const file = fileInput.files[0];
      const preview = document.getElementById('3u');
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        }
        reader.readAsDataURL(file);
      } else {
        preview.src = '';
        preview.style.display = 'none';
      }
    }

    async function uploadImage(event) {
      event.preventDefault();
      const fileInput = document.getElementById('file-input');
      if (!fileInput) {
        console.error('File input not found.');
        return;
      }
      const file = fileInput.files[0];
      if (!file) {
        alert('Please select a file to upload.');
        return;
      }
      const formData = new FormData();
      formData.append('file', file);
      try {
        const response = await fetch('https://upl-img-url.socialitin.workers.dev/', {
          method: 'POST',
          body: formData
        });
        const result = await response.json();
        if (response.ok) {
          alert('Image uploaded successfully!');
          const data2 = result.variants;
          const data = data2[0];
          const ppicsj = JSON.parse(sessionStorage.getItem("pics"));
          const cImgId = event.target.id;
          const idis = cImgId.charAt(cImgId.length - 1);
          ppicsj[idis].name = document.getElementById("picname").value;
          ppicsj[idis].description = document.getElementById("descI").value;
          ppicsj[idis].img = data;
          sessionStorage.setItem("pics", JSON.stringify(ppicsj));
          const picUrl = `<img src="${data}" style="width:99%;"></img>`;
          document.getElementById("itemImg").innerHTML = picUrl;
          document.getElementById(idis).src = data;
        } else {
          alert(`Failed to upload image: ${result}`);
        }
      } catch (error) {
        console.error('Error uploading image:', error);
        alert('An error occurred while uploading the image.');
      }
    }

    function picPost(evt, id) {
      const ppicsj = JSON.parse(sessionStorage.getItem("pics"));
      ppicsj[id].name = document.getElementById("name").value;
      ppicsj[id].description = document.getElementById("descI").value;
      sessionStorage.setItem("pics", JSON.stringify(ppicsj));
    }

    function subscribeAug1724() {
      const ws = new WebSocket('wss:pub-sub.socialitin.workers.dev/subscribe');
      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (window.onMessageReceived) {
          window.onMessageReceived(data);
        } else {
          console.log('Received:', data.message);
        }
      };
      ws.onopen = () => {
        console.log('Subscribed to the channel');
      };
      ws.onclose = () => {
        console.log('Subscription closed');
      };
      ws.onerror = (error) => {
        console.error('WebSocket error:', error);
      };
    }

    async function replyToConversation(conversationId, message) {
      try {
        const response = await fetch(`https://pub-sub.socialitin.workers.dev/reply/${conversationId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ message }),
        });
        if (response.ok) {
          console.log(`Message added to conversation ${conversationId}`);
        } else {
          console.error(`Failed to add message to conversation:`, response.statusText);
        }
      } catch (error) {
        console.error(`Error replying to conversation:`, error);
      }
    }

    function publishAug1724(message) {
      fetch('https://pub-sub.socialitin.workers.dev/publish', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ message: message }),
      })
        .then(response => response.text())
        .then(data => {
          console.log('Message sent:', data);
        })
        .catch(error => {
          console.error('Error sending message:', error);
        });
    }

    async function initiateConversation(cityCode, serviceType, message) {
      try {
        const response = await fetch(`https://pub-sub.socialitin.workers.dev/initiate/${cityCode}/${serviceType}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ message }),
        });
        if (response.ok) {
          const data = await response.json();
          console.log(`Conversation initiated with ID: ${data.conversationId}`);
          return data.conversationId;
        } else {
          console.error(`Failed to initiate conversation:`, response.statusText);
        }
      } catch (error) {
        console.error(`Error initiating conversation:`, error);
      }
    }

    async function fetchjson() {
      const response = await fetch('/api/fetchjson');
      const data = await response.json();
      console.log(data);
      sessionStorage.setItem("j2post", JSON.stringify(data));
      const j2addStorage = {
        "IATA": "US2",
        "City": "US3-Eastern",
        "Province": "Western",
        "embVideo": "<div style=\"position: relative; padding-top: 100%;\"><iframe src=\"https://iframe.videodelivery.net/c572438216d9778a180b4df0784ffb4d?poster=https%3A%2F%2Fvideodelivery.net%2Fc572438216d9778a180b4df0784ffb4d%2Fthumbnails%2Fthumbnail.jpg%3Ftime%3D%26height%3D600\" style=\"border: none; position: absolute; top: 0; left: 0; height: 100%; width: 100%;\" allow=\"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;\" allowfullscreen=\"true\"></iframe></div>",
        "Pictures": "[{\"img\":\"https://mmedia.tournet.com/Tournet/www.travelknowhow.com/New York/ChicagoMusical/Orquesta center.png\",\"description\":\"tickets from $ 150 to $420\",\"name\":\"Orquesta Center \"},{\"img\":\"https://mmedia.tournet.com/Tournet/www.travelknowhow.com/New York/ChicagoMusical/Orquesta sides.png\",\"description\":\"tickets from $ 120 \",\"name\":\"Orquesta left and right\"},{\"img\":\"https://mmedia.tournet.com/Tournet/www.travelknowhow.com/New York/ChicagoMusical/Mezzanine.png\",\"description\":\"tickets from $ 120 \",\"name\":\"Mezzanine \"},{\"img\":\"https://mmedia.tournet.com/Tournet/www.travelknowhow.com/New York/ChicagoMusical/Rear Mezzanine.png\",\"description\":\"tickets from $ 120\",\"name\":\"Mezzanine Rear \"}]",
        "Pitch": "NOT Unique and captivating, with channels that continually change a scenario unlike any other in the world."
      };
      const j2add = j2addStorage;
      const j2publish = data;
      j2publish["NYCS"].push(j2add);
      console.log(j2publish);
    }

    // Initialize the application
    d1tnlogin();
  });
</script>

